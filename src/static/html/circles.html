<!doctype html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html {
      font-size: 16px;
    }
    html, body {
      width: 100%;
      height: 100%;
      max-width: 100vw;
      max-height: 100vh;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    body {
      verflow: hidden;
      background-color: #EEE;
    }
  </style>
  <script>
    const isMobile = window.matchMedia('(max-device-width: 600px)').matches
    const isLocalhost = window.location.hostname==='localhost'

    const inited = ()=>requestAnimationFrame(()=>document.body.dispatchEvent(new CustomEvent('inited')))

    isMobile
      &&isLocalhost
      &&!globalThis.eruda
      ?document.addEventListener('DOMContentLoaded',()=>{
        const script = loadScript('//cdn.jsdelivr.net/npm/eruda')
        script.addEventListener('load',()=>{
          eruda.init()
          inited()
        })
      })
      :inited()
    
    function loadScript(src){
      const script = document.createElement('script')
      script.src = src
      document.body.appendChild(script)
      return script
    }
  </script>
</head>
<body>
<style>
:root {
  --t: 1;
  --w: 8rem;
  --c1: transparent;
  --c2: transparent;
}
body {
  background-color: #000;
}
.circles {
  width: 100%;
  height: 100%;
  padding: 50% 0 0 50%;
  div {
    position: absolute;
    width: var(--w);
    height: var(--w);
    box-shadow: 0 0 4rem var(--c1), 0 0 3rem var(--c2) inset;
    transform: translate(-50%,-50%);
    transition: all 3000ms ease;
  }
  &>div {
    position: static;
    width: 50vw;
    height: 50vw;
  }
}
</style>
<script>
  const {body,styleSheets} = document

  let seed = 1234
  const md = 2**32
  function random(_seed){
    if (_seed!==undefined) seed = _seed
    seed = (1664525*seed + 1013904223)%md
    return seed/md
  }

  const startT = Date.now() - (rnd(1E9)<<0)
  function animate(){
    body.style.setProperty('--t', Date.now()-startT)
    requestAnimationFrame(animate)
  }
  animate()
  
  body.addEventListener('inited',()=>{

    readHash()

    const div = 'div'
    const circles = createElement(div,body,null)
    circles.classList.add('circles')

    let circle = circles
    arf(20).map(()=>circle=createElement(div,circle))

    const style = styleSheets[styleSheets.length-1]
    style.insertRule('.circles>div div { color: white }', 0)
    const rule = style.rules[0]

    body.addEventListener('click',onBodyClick.bind(null,rule.style))
    reset(rule.style)

    window.addEventListener('hashchange', onHashChange.bind(null,rule.style), false)
  })

  function onBodyClick(style){
    location.hash = seed = Math.random()*2E9<<0
    reset(style)
  }
  
  function onHashChange(style){
    readHash()
    reset(style)
  }

  function readHash(){
    const {hash} = location
    if (/^#-?\d+$/.test(hash)) seed = parseInt(hash.substr(1),10)
  }

  function reset(style){
    style.transform = `
      rotate(calc(120deg + 40deg * sin(${rnd(0.0001)} * var(--t))))
      translate(${rnd(70,20,'%',true)},0)
    `
    style.borderRadius = rnd(2)<1?0:'50%'
    style.setProperty('--w', rnd(40,102,'%',true))
    style.setProperty('--c1', randomColor())
    style.setProperty('--c2', randomColor())
  }

  function arf(len){
    return Array.from(typeof len==='number'?new Array(len):len)
  }

  function createElement(type, parent, style, props){
    const elm = document.createElement(type)
    style&&Object.assign(elm.style, style)
    parent?.appendChild(elm)
    return elm
  }

  function rnd(size=1, offset=0, unit=0, whole=false){
    const w = i=>whole?parseInt(i,10):i
    return w(offset + size*random()) + unit
  }

  function randomColor(){
    return '#'+random().toString(16).slice(-6)// + '66'
  }

</script>
</body>

